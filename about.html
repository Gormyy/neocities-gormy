<!DOCTYPE html>
<html>

<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="http://fonts.googleapis.com/css?family=Megrim|Lato" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>About</title>

  <link rel="stylesheet" href="resources/css/kittyStyle.css">
  <script src = "resources/js/utils/addNavigation.js">//adds addNavidation(div, pathToRoot = "", centered = true, navigationElements = "default") to add the navigation to the div bar</script>
  <script src="resources/js/bubbleScript.js"></script>
</head>

<body>

  <div id="header">
    Gormy's site
  </div>


  <div id="menu">

  </div>

  <script>
    //script to add navigation elements
    let div = document.getElementById("menu")
    addNavigation(div)
  </script>

  <div id="sidebar">

    <img
      src="https://64.media.tumblr.com/ce99e75c0062603e1b3f974bf3d1d7a9/5b2b6fc3dc12a5a9-55/s400x600/447a4f8ea6145ee368fdb6e588f80947d875e97c.jpg"
      class="sideimg"><br>

    <div class="sidetitle">About me</div>
    <!--I think it would be really funny to use javascript to automatically update my age, do this later-->
    Hi I'm Gormy! I'm a <span id="age"></span> year old girl that was born in Florida but I was mostly raised in
    Indiana. I have a Master's Degree in Computer Science from Purdue. I really like hockey, especially the St. Louis
    Blues. I love traveling! I also climb sometimes. I'm also an occasional artist and photographer. I'm also a big fan
    of Glaceon!
    <div class="sidetitle">Contact</div>
    I want to put my email on here but I really don't want to put my main email on this site, but I have
    <i>gormywebsite@gmail.com</i> and <i>gormywebsite2@gmail.com</i> that you could use to contact me, but I
    accidentally made gormywebsite@gmail.com a child account that is aged like 8 years old so I can't really use it to
    recieve emails, and gormywebsite2@gmail.com gets constantly spammed with my current location so I probably won't see
    any emails there. For now, just contact me through Discord because that's probably where you found my website from
    anyway. <br> I also have a <a href="https://bsky.app/profile/gormy.bsky.social">bluesky</a> so you can follow me
    there! However I'm not very active on it unfortunately.
    <div class="sidetitle">credits</div>

    <b>Layout</b> <a href="http://itinerae.neocities.org">Itinerae</a><br>
    <b>Image</b> <a href="pinterest.com/pin/474707616989750289/">Pinterest</a><br>
    <b>Background</b> <a href="https://lovesick.cafe">Lovesick</a><br>
    <b>Bubble effect</b> <a href="https://www.mf2fm.com/rv/dhtmlbubbles.php">x</a>

  </div>

  <div id="content">
    <div class="contenttitle">Fun Facts!</div>

    <p>Here I'm going to put some Fun Facts about me! </p>

    <ul>
      <li>I've been in an elevator with the CEO of Burger King twice</li>
      <li>My friend Hailey's phone number is 507-246-6707.</li>
      <li>812-492-2854</li>
      <li>One time my elementary school got on national news because they scheduled picture day on St. Patrick's day. I
        wasn't a student at the time unfortunately.</li>
      <li>I am above average at throwing and catching a frisbee</li>
      <li>If I played hockey I would be a goalie</li>
      <li>One time during summer break when I was in elementary school some teenagers burnt down a playground at our
        school with discarded math textbooks. As a kid I was kind of pissed but as an adult I'm still a little pissed
        but I also think it's kind of funny to burn down a playground and they also had the decency to burn down the
        least fun playground.</li>
      <li>I need suggestions for what to do with the other 2 sections so please give me suggestions on Discord!</li>
      <li>Hailey's current location is <span id="haileyLocation">Location loading...</span></li>
    </ul>

    <script>
      //Hailey location code!
      fetch('https://gormysecret.onrender.com/location?user=Hailey&format=json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch location');
          }
          return response.json();
        })
        .then(data => {
          const { city, state, country } = data;
          const locationText = `${city ? city + ', ' : ''}${state ? state + ', ' : ''}${country}`;
          document.getElementById('haileyLocation').textContent = locationText || 'Location not available';
        })
        .catch(error => {
          console.error(error);
          document.getElementById('haileyLocation').textContent = 'Error retrieving location';
        });
    </script>

    <div class="contenttitle">Comments</div>
    <br>
    <center>
      <div class="scrollable-div" id="scrollableDiv">
        <p><strong></strong></p>
      </div>
    </center>
    <br><br>

    <script>
      const scrollDiv = document.getElementById("scrollableDiv");
      function getDeterministicColor(input) {
        //Simple hash function (djb2)
        let day = new Date().getDay()
        let month = new Date().getMonth()
        let year = new Date().getFullYear()
        let hash = day * month * year
        for (let i = 0; i < input.length; i++) {
          hash = ((hash << 5) + hash) + input.charCodeAt(i);
          hash = hash & hash; //Convert to 32bit integer
        }

        //Generate RGB values based on hash
        const r = (hash >> 16) & 0xFF;
        const g = (hash >> 8) & 0xFF;
        const b = hash & 0xFF;

        //Convert to hex string and pad if needed
        const toHex = (n) => n.toString(16).padStart(2, '0');

        return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
      }

      //Gets the messages
      let currentPage = 1;
      let canFetchMore = true;
      //const scrollDiv = document.getElementById('scrollableDiv');

      function createMessageElement(name, message) {
        const p = document.createElement('p');
        let color = getDeterministicColor(name)
        p.innerHTML = `<strong style="color:${color}">${name}</strong>: ${message}`;
        return p;
      }

      //please don't abuse this :3 i know all the posting messages and stuff are publicly accesible endpoints but i just want to make a fun 'lil website so please don't try to intentionally break it that wouldn't be fun.
      async function loadMessages(page) {
        const res = await fetch(`https://gormysecret.onrender.com/getMessages?page=${page}`);
        const result = await res.json();

        if (!result.isFull) {
          canFetchMore = false;
        }

        const messages = result.messages;

        if (messages.length === 0) return;

        const scrollHeightBefore = scrollDiv.scrollHeight;

        messages.forEach(msg => {
          const el = createMessageElement(msg.name, msg.message);
          scrollDiv.insertBefore(el, scrollDiv.firstChild);
        });

        //Preserve scroll position after prepending
        const scrollHeightAfter = scrollDiv.scrollHeight;
        scrollDiv.scrollTop += scrollHeightAfter - scrollHeightBefore;
      }

      //Load first page initially
      loadMessages(currentPage).then(() => {
        //Scroll to bottom on first load
        scrollDiv.scrollTop = scrollDiv.scrollHeight;
      });

      //Scroll listener to detect when user reaches top
      scrollDiv.addEventListener('scroll', async () => {
        if (scrollDiv.scrollTop === 0 && canFetchMore) {
          currentPage++;
          await loadMessages(currentPage);
        }
      });

      // Scroll to the bottom after the content is loaded
      scrollDiv.scrollTop = scrollDiv.scrollHeight;

      async function postComment() {
        const nameInput = document.getElementById("nameInput").value.trim()
        const messageInput = document.getElementById("messageInput").value.trim()
        const messages = document.getElementById("messageStatus")
        if (nameInput === "" || messageInput === "") {
          messages.innerHTML = "Name/message cannot be empty"
          return
        }

        url = `https://gormysecret.onrender.com/postMessage?name=${nameInput}&message=${messageInput}`;
        //console.log(url)
        const response = await fetch(url);
        if (!response.ok) {
          messages.innerHTML = "message failed to post"
          return
        }

        const data = await response.json();
        messages.innerHTML = "Message posted!"
        location.reload();
      }
    </script>

    <div class="contenttitle">Post a comment</div>
    <center>
      <p>Please be nice when commenting :)</p>
    </center>
    <center>
      <p>Also people are impersonating me because i didn't add any authentication but i also think that's kind of funny
        so i'm not going to add any authentication</p>
    </center>

    <center>
      <button class="rounded-btn" id="changeUsername" onclick="postComment()">Post Comment</button><br><br>

      <label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name: </label><input type="text" id="nameInput"></input> <br>
      <label> Message: </label><input type="text" id="messageInput"></input>
      <br><br>
      <p id="messageStatus"></p>
    </center>
    <div class="contenttitle">Badges</div>
    Please give me more badges
    <br><br>
    <img src="neocities.png" alt="neocities badge" width="100">


  </div>

  <script>
    function yearsSince(date) {
      const currentDate = new Date();
      const targetDate = new Date(date);

      let yearsPassed = currentDate.getFullYear() - targetDate.getFullYear();

      if (
        currentDate.getMonth() < targetDate.getMonth() ||
        (currentDate.getMonth() === targetDate.getMonth() && currentDate.getDate() < targetDate.getDate())
      ) {
        yearsPassed--;
      }

      return yearsPassed;
    }

    const date = '2003-02-23';
    const years = yearsSince(date);

    document.getElementById('age').textContent = years; //updates birthday
  </script>

</body>

</html>